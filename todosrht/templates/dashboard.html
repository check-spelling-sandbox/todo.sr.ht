{% extends "todo.html" %}
{% block content %}
<div class="container">
  <div class="row">
    <div class="col-md-4">
      {% if profile %}
      <h2>
        ~{{ profile.get("username") }}
      </h2>
      {% else %}
      <h2>todo</h2>
      <p>
        Welcome back, {{ current_user.username }}!
      </p>
      {% endif %}

      {% if profile %}
      {% if profile.get("location") %}
      <p>{{profile["location"]}}</p>
      {% endif %}
      {% if profile.get("url") %}
      <p>
        <a href="{{profile["url"]}}" target="_blank">
          {{profile["url"]}}
        </a>
      </p>
      {% endif %}
      {% if profile.get("bio") %}
      <p>{{profile["bio"]}}</p>
      {% endif %}
      {% endif %}

      {% if profile and (current_user and user.id == current_user.id) %}
      <div class="alert alert-info">
        This is your public profile page.
      </div>
      {% endif %}

      <h3>{{ tracker_list_msg }}</h3>
      {% if len(trackers) > 0 %}
      <div class="tracker-list">
        {% for tracker in trackers %}
        <h4>{{ format_tracker_name(tracker, full=True) }}</h4>
        <span class="text-muted">Last active {{ tracker.updated | date }}</span>
        {% endfor %}
      </div>
      {% if not user or (current_user and user.id == current_user.id) %}
      <a
        style="margin-top: 1rem"
        class="btn btn-default btn-block"
        href="{{ url_for("tracker.create_GET") }}"
      >Create new tracker</a>
      {% endif %}
      {% else %}
      <p>
        Nothing here yet! Would you like to
        <a href="{{ url_for("tracker.create_GET") }}">create one</a>?
      </p>
      {% endif %}
    </div>
    <div class="col-md-8">
      <h3>Recent Activity</h3>
      {% if events %}
      <div class="events">
        {% for event in events %}
        <div class="event">
          <h4>
            <a href="{{ url_for("ticket.ticket_GET",
              owner="~" + event.ticket.tracker.owner.username,
              name=event.ticket.tracker.name,
              ticket_id=event.ticket.scoped_id) }}">
              #{{event.ticket.scoped_id}}
            </a> {{ event.ticket.title }}
            <small class="pull-right">
              {{ event.created | date }}
            </small>
          </h4>
          {% if EventType.created in event.event_type %}
          <p>
            Ticket created by
            <a href="/~{{ event.ticket.submitter.username }}">
              ~{{ event.ticket.submitter.username }}
            </a>
            on {{ format_tracker_name(event.ticket.tracker, full=True) }}{%
            if event.ticket.description %}:{% endif %}
          </p>
          {% endif %}
          {% if EventType.comment in event.event_type %}
          <p>
            Comment by
            <a href="/~{{ event.ticket.submitter.username }}">
              ~{{ event.ticket.submitter.username }}
            </a>
            on {{ format_tracker_name(event.ticket.tracker, full=True) }}:
          </p>
          {% endif %}
          <blockquote>
            {% if event.comment %}
            {{ event.comment.text | md }}
            {% else %}
            {% if EventType.created in event.event_type %}
            {{ event.ticket.description | md }}
            {% endif %}
            {% endif %}
          </blockquote>
          {% if EventType.status_change in event.event_type %}
          <p>
            <strong class="text-success">
              {{ event.old_status.name.upper() }}
              {% if event.old_status == TicketStatus.resolved %}
              {{ event.old_resolution.name.upper() }}
              {% endif %}
            </strong>
            <span class="fa fa-arrow-right"></span>
            <strong class="text-success">
              {{ event.new_status.name.upper() }}
              {% if event.new_status == TicketStatus.resolved %}
              {{ event.new_resolution.name.upper() }}
              {% endif %}
            </strong>
          </p>
        {% endif %}
        </div>
        {% endfor %}
      {% else %}
        <p>Nothing here yet!</p>
      {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
